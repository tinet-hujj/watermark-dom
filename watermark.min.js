!function(e,t){"function"==typeof define&&define.amd?define([],t()):"object"==typeof module&&module.exports?module.exports=t():e.watermark=t()}(this,function(){var r,e={},t=!1,v={watermark_id:"wm_div_id",watermark_prefix:"mask_div_id",watermark_txt:"测试水印",watermark_x:20,watermark_y:20,watermark_rows:0,watermark_cols:0,watermark_x_space:50,watermark_y_space:50,watermark_font:"微软雅黑",watermark_color:"black",watermark_fontsize:"18px",watermark_alpha:.15,watermark_width:100,watermark_height:100,watermark_angle:15,watermark_parent_width:0,watermark_parent_height:0,watermark_parent_node:null,monitor:!1},a=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,x=void 0!==a,b=x?new a(function(e){t?t=!1:(r&&1===e.length||1===e.length&&1<=e[0].removedNodes.length)&&o(r)}):null,I={childList:!0,attributes:!0,subtree:!0},o=function(r){if(1===arguments.length&&"object"==typeof r){var e=r||{};for(key in e)e[key]&&v[key]&&e[key]===v[key]||!e[key]&&0!==e[key]||(v[key]=e[key])}var t,a=document.getElementById(v.watermark_id),o=(a&&a.parentNode&&a.parentNode.removeChild(a),document.getElementById(v.watermark_parent_node)),m=o||document.body,n=Math.max(m.scrollWidth,m.clientWidth),w=Math.max(m.scrollHeight,m.clientHeight),a=r||{},i=m,_=0,d=0,a=(a.watermark_parent_width||a.watermark_parent_height?i&&(_=i.offsetTop||0,d=i.offsetLeft||0,v.watermark_x=v.watermark_x+d,v.watermark_y=v.watermark_y+_):i&&(_=i.offsetTop||0,d=i.offsetLeft||0),document.getElementById(v.watermark_id)),k=null,i=(a?a.shadowRoot&&(k=a.shadowRoot):((a=document.createElement("div")).id=v.watermark_id,a.setAttribute("style","pointer-events: none !important; display: block !important"),k=a,(i=m.children)[l=Math.floor(Math.random()*(i.length-1))]?m.insertBefore(a,i[l]):m.appendChild(a)),v.watermark_cols=parseInt((n-v.watermark_x)/(v.watermark_width+v.watermark_x_space)),parseInt((n-v.watermark_x-v.watermark_width*v.watermark_cols)/v.watermark_cols)),l=(v.watermark_x_space=i&&v.watermark_x_space,v.watermark_rows=parseInt((w-v.watermark_y)/(v.watermark_height+v.watermark_y_space)),parseInt((w-v.watermark_y-v.watermark_height*v.watermark_rows)/v.watermark_rows));v.watermark_y_space=l&&v.watermark_y_space;for(var s=o?(t=v.watermark_x+v.watermark_width*v.watermark_cols+v.watermark_x_space*(v.watermark_cols-1),v.watermark_y+v.watermark_height*v.watermark_rows+v.watermark_y_space*(v.watermark_rows-1)):(t=d+v.watermark_x+v.watermark_width*v.watermark_cols+v.watermark_x_space*(v.watermark_cols-1),_+v.watermark_y+v.watermark_height*v.watermark_rows+v.watermark_y_space*(v.watermark_rows-1)),y=0;y<v.watermark_rows;y++)for(var h=o?_+v.watermark_y+(v.watermark_y_space+v.watermark_height)*y:v.watermark_y+(w-s)/2+(v.watermark_y_space+v.watermark_height)*y,c=0;c<v.watermark_cols;c++){var p=o?d+v.watermark_x+(n-t)/2+(v.watermark_width+v.watermark_x_space)*c:v.watermark_x+(n-t)/2+(v.watermark_width+v.watermark_x_space)*c,f=document.createElement("div"),g=document.createTextNode(v.watermark_txt);f.appendChild(g),f.id=v.watermark_prefix+y+c,f.style.webkitTransform="rotate(-"+v.watermark_angle+"deg)",f.style.MozTransform="rotate(-"+v.watermark_angle+"deg)",f.style.msTransform="rotate(-"+v.watermark_angle+"deg)",f.style.OTransform="rotate(-"+v.watermark_angle+"deg)",f.style.transform="rotate(-"+v.watermark_angle+"deg)",f.style.visibility="",f.style.position="absolute",f.style.left=p+"px",f.style.top=h+"px",f.style.overflow="hidden",f.style.zIndex="9999999",f.style.opacity=v.watermark_alpha,f.style.fontSize=v.watermark_fontsize,f.style.fontFamily=v.watermark_font,f.style.color=v.watermark_color,f.style.textAlign="center",f.style.width=v.watermark_width+"px",f.style.height=v.watermark_height+"px",f.style.display="block",f.style["-ms-user-select"]="none",k.appendChild(f)}let u=0;document.getElementById(v.watermark_id).childNodes.forEach((t,e)=>{html2canvas(t).then(e=>{e.style.position=t.style.position,e.style.left=t.style.left,e.style.top=t.style.top,e.style.zIndex=-999999,document.getElementById(v.watermark_id).replaceChild(e,t),++u<document.getElementById(v.watermark_id).childNodes.length||(console.log("执行"),(void 0===r.monitor?v:r).monitor&&x&&(b.observe(m,I),b.observe(document.getElementById(v.watermark_id).shadowRoot,I)))})})},b=(e.init=function(e){o(r=e),window.addEventListener("onload",function(){o(e)}),window.addEventListener("resize",function(){o(e)})},e.load=function(e){o(r=e)},e.remove=function(){t=!0,function(){if(1===arguments.length&&"object"==typeof arguments[0]){var e=arguments[0]||{};for(key in e)e[key]&&v[key]&&e[key]===v[key]||!e[key]&&0!==e[key]||(v[key]=e[key])}var t=document.getElementById(v.watermark_id);t.parentNode.removeChild(t),b.disconnect()}()},new(window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver)(function(e){var t;r&&1===e.length||1===e.length&&1<=e[0].removedNodes.length?o(r):(e=document.getElementById(v.watermark_parent_node))&&(t=getComputedStyle(e).getPropertyValue("width"),e=getComputedStyle(e).getPropertyValue("height"),t===m.width&&e===m.height||(m.width=t,m.height=e,o(r)))})),I={childList:!0,attributes:!0,subtree:!0,attributeFilter:["style"],attributeOldValue:!0},m={width:0,height:0};return e});